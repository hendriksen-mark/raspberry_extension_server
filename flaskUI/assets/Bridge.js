import{f as z,d as V,r as l,j as e,F as M,G as d,W as we,a as h,n as a}from"./index.js";import{u as ke,t as Ae}from"./timezone.js";import{G as v}from"./GenericText.js";import{S as Ce}from"./SelectMenu.js";import{G as L}from"./GlassContainer.js";import{P as S}from"./PageContent.js";import{C as Re}from"./CardGrid.js";import{c as $}from"./reactConfirmAlert.js";var J={exports:{}};(function(f,P){(function(r,b){b()})(z,function(){function r(s,t){return typeof t>"u"?t={autoBom:!1}:typeof t!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\uFEFF",s],{type:s.type}):s}function b(s,t,m){var n=new XMLHttpRequest;n.open("GET",s),n.responseType="blob",n.onload=function(){x(n.response,t,m)},n.onerror=function(){console.error("could not download file")},n.send()}function D(s){var t=new XMLHttpRequest;t.open("HEAD",s,!1);try{t.send()}catch{}return 200<=t.status&&299>=t.status}function i(s){try{s.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),s.dispatchEvent(t)}}var u=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof z=="object"&&z.global===z?z:void 0,A=u.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),x=u.saveAs||(typeof window!="object"||window!==u?function(){}:"download"in HTMLAnchorElement.prototype&&!A?function(s,t,m){var n=u.URL||u.webkitURL,c=document.createElement("a");t=t||s.name||"download",c.download=t,c.rel="noopener",typeof s=="string"?(c.href=s,c.origin===location.origin?i(c):D(c.href)?b(s,t,m):i(c,c.target="_blank")):(c.href=n.createObjectURL(s),setTimeout(function(){n.revokeObjectURL(c.href)},4e4),setTimeout(function(){i(c)},0))}:"msSaveOrOpenBlob"in navigator?function(s,t,m){if(t=t||s.name||"download",typeof s!="string")navigator.msSaveOrOpenBlob(r(s,m),t);else if(D(s))b(s,t,m);else{var n=document.createElement("a");n.href=s,n.target="_blank",setTimeout(function(){i(n)})}}:function(s,t,m,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),typeof s=="string")return b(s,t,m);var c=s.type==="application/octet-stream",N=/constructor/i.test(u.HTMLElement)||u.safari,y=/CriOS\/[\d]+/.test(navigator.userAgent);if((y||c&&N||A)&&typeof FileReader<"u"){var w=new FileReader;w.onloadend=function(){var p=w.result;p=y?p:p.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=p:location=p,n=null},w.readAsDataURL(s)}else{var C=u.URL||u.webkitURL,k=C.createObjectURL(s);n?n.location=k:location.href=k,n=null,setTimeout(function(){C.revokeObjectURL(k)},4e4)}});u.saveAs=x.saveAs=x,f.exports=x})})(J);var _=J.exports;V.extend(ke);V.extend(Ae);const Te=({HOST_IP:f,API_KEY:P,CONFIG:r})=>{const b=V.tz.guess(),D=r.timezones,i=r.info,u=r.config.swupdate2.autoinstall.updatetime.replace("T",""),[A,x]=l.useState(r.config.name),[s,t]=l.useState(r.config.swversion),[m,n]=l.useState(r.config.apiversion),[c,N]=l.useState(r.config["Remote API enabled"]),[y,w]=l.useState(r.config.discovery),[C,k]=l.useState(r.config.timezone),[p,Y]=l.useState(r.config.LogLevel),[Q,H]=l.useState(!1),[Z,B]=l.useState(""),[F,T]=l.useState({}),[U,O]=l.useState(!1),[R,G]=l.useState(r.config),[q,j]=l.useState(!1);l.useEffect(()=>{q||(x(r.config.name),t(r.config.swversion),n(r.config.apiversion),N(r.config["Remote API enabled"]),w(r.config.discovery),k(r.config.timezone),Y(r.config.LogLevel),G(r.config))},[r,q]);const I=o=>{x(o),j(!0)},ee=o=>{t(o),j(!0)},oe=o=>{n(o),j(!0)},se=o=>{k(o),j(!0)},te=o=>{Y(o),j(!0)},ne=o=>{N(o),j(!0)},re=o=>{w(o),j(!0)},W=()=>{H(!0)},g=()=>{H(!1)},ae=()=>{h.put(`${f}/api/${P}/config`,{name:A,swversion:s,apiversion:m,timezone:C,"Remote API enabled":c,discovery:y,loglevel:p}).then(o=>{a.success("Successfully saved")}).catch(o=>{console.error(o),a.error(`Error occurred: ${o.message}`)})},ce=()=>{B("Force Config Dump Options"),T(e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Where do you want to save config?"}),e.jsx("p",{children:"Never share the config.tar!"}),e.jsx("div",{className:"form-control",children:e.jsx(d,{value:"DiyHue local",color:"blue",size:"",type:"submit",onClick:()=>X(!1)})}),e.jsx("div",{className:"form-control",children:e.jsx(d,{value:"DiyHue backup",color:"blue",size:"",type:"submit",onClick:()=>ie()})}),e.jsx("div",{className:"form-control",children:e.jsx(d,{value:"Download tar",color:"blue",size:"",type:"submit",onClick:()=>le()})})]})),W()},X=o=>{h.get(`${f}/save`).then(()=>{a.success("Config dumped to local disk"),o===!0&&E()}).catch(K=>{console.error(K),a.error(`Error occurred: ${K.message}`)}),g()},ie=()=>{h.get(`${f}/save?backup=True`).then(()=>{a.success("Backup to local disk")}).catch(o=>{console.error(o),a.error(`Error occurred: ${o.message}`)}),g()},le=()=>{h.get(`${f}/download_config`,{responseType:"blob"}).then(o=>{_.saveAs(o.data,"config.tar"),a.success("Download config tar")}).catch(o=>{console.error(o),a.error(`Error occurred: ${o.message}`)}),g()},de=()=>{$({title:"Restart Python.",message:`Are you sure to do this?
This will NOT save the current config.`,buttons:[{label:"Yes",onClick:()=>E()},{label:"Save first",onClick:()=>X(!0)},{label:"No"}]})},E=()=>{h.get(`${f}/restart`).then(()=>{a.success("Restart Python")}).catch(o=>{o.message==="Network Error"?a.success("Restart Python"):(console.error(o),a.error(`Error occurred: ${o.message}`))})},ue=()=>{B("Reset Config Options"),T(e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"How do you want to restore config?"}),e.jsx("p",{children:"Please be careful of what you do!"}),e.jsx("div",{className:"form-control",children:e.jsx(d,{value:"Restore backup",color:"red",size:"",type:"submit",onClick:()=>ge()})}),e.jsx("div",{className:"form-control",children:e.jsx(d,{value:"Reset config",color:"red",size:"",type:"submit",onClick:()=>he()})}),e.jsx("div",{className:"form-control",children:e.jsx(d,{value:"Remove certificate",color:"red",size:"",type:"submit",onClick:()=>me()})})]})),W()},me=()=>{$({title:"Remove certificate.",message:`Are you sure to do this?
This also makes a backup.`,buttons:[{label:"Yes",onClick:()=>fe()},{label:"No"}]})},fe=()=>{h.get(`${f}/remove_cert`).then(()=>{a.success("Certificate removed"),E()}).catch(o=>{console.error(o),a.error(`Error occurred: ${o.message}`)}),g()},he=()=>{$({title:"Reset config to default.",message:`Are you sure to do this?
This also makes a backup.`,buttons:[{label:"Yes",onClick:()=>pe()},{label:"No"}]})},pe=()=>{h.get(`${f}/reset_config`).then(()=>{a.success("Reset config"),E()}).catch(o=>{console.error(o),a.error(`Error occurred: ${o.message}`)}),g()},ge=()=>{$({title:"Restore config from backup.",message:`Are you sure to do this?
This will NOT make a backup.`,buttons:[{label:"Yes",onClick:()=>ve()},{label:"No"}]})},ve=()=>{h.get(`${f}/restore_config`).then(()=>{a.success("restore config"),E()}).catch(o=>{console.error(o),a.error(`Error occurred: ${o.message}`)}),g()},be=()=>{B("Debug download Options"),T(e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Download full debug or log"}),e.jsx("div",{className:"form-control",children:e.jsx(d,{value:"Full Debug",color:"blue",size:"",type:"submit",onClick:()=>xe()})}),e.jsx("div",{className:"form-control",children:e.jsx(d,{value:"Log file",color:"blue",size:"",type:"submit",onClick:()=>je()})})]})),W()},xe=()=>{h.get(`${f}/download_debug`,{responseType:"blob"}).then(o=>{_.saveAs(o.data,"config_debug.tar"),a.success("Download debug tar")}).catch(o=>{console.error(o),a.error(`Error occurred: ${o.message}`)}),g()},je=()=>{h.get(`${f}/download_log`,{responseType:"blob"}).then(o=>{_.saveAs(o.data,"diyhue_log.tar"),a.success("Download log tar")}).catch(o=>{console.error(o),a.error(`Error occurred: ${o.message}`)}),g()};let ye=D.map(function(o){return{value:o,label:o}});return e.jsx("div",{className:"inner",children:e.jsxs(Re,{options:"main",children:[e.jsx(L,{options:"spacer",children:e.jsxs(S,{children:[e.jsx("div",{className:"headline",children:"Bridge Config"}),e.jsx("div",{className:"form-control",children:e.jsx(v,{label:"Bridge Name",type:"text",placeholder:"Bridge Name",value:A,onChange:o=>I(o)})}),e.jsxs("div",{className:"form-control",children:[e.jsx(v,{label:`Software Version (checks automatic at ${u})`,type:"number",pattern:"[0-9]+",placeholder:"swversion",value:s,onChange:o=>ee(o)}),e.jsx("p",{children:e.jsx("a",{href:"https://www.philips-hue.com/en-gb/support/release-notes/bridge",children:"check here for last versions"})})]}),e.jsx("div",{className:"form-control",children:e.jsx(v,{label:`API Version (checks automatic at ${u})`,type:"text",placeholder:"apiversion",value:m,onChange:o=>oe(o)})}),e.jsx("div",{className:"form-control",children:e.jsx(Ce,{label:`Timezone (suggested: ${b})`,options:ye,onChange:o=>se(o.value),placeholder:C})}),e.jsx("div",{className:"form-control",children:e.jsx(M,{id:"Debug",value:p==="DEBUG",onChange:o=>te(o===!0?"DEBUG":"INFO"),checked:p==="DEBUG",label:"Temporarily Enable Debug Log",position:"right"})}),e.jsx("div",{className:"form-control",children:e.jsx(M,{id:"Remote API",value:c,onChange:o=>ne(o),checked:c,label:"Remote API",position:"right"})}),e.jsx("div",{className:"form-control",children:e.jsx(M,{id:"Discovery",value:y,onChange:o=>re(o),checked:y,label:"Discovery",position:"right"})}),e.jsx("div",{className:"form-control",children:e.jsx(d,{value:"Save",color:"blue",size:"",type:"submit",onClick:()=>ae()})})]})}),e.jsx(L,{options:"spacer",children:e.jsxs(S,{children:[e.jsx("div",{className:"headline",children:"Readonly Config"}),e.jsx("div",{className:"form-control",children:e.jsx(v,{label:"BridgeID",readOnly:!0,type:"text",placeholder:"bridgeid",value:R.bridgeid})}),e.jsx("div",{className:"form-control",children:e.jsx(v,{label:"IP Address",readOnly:!0,type:"text",placeholder:"iP",value:R.ipaddress})}),e.jsx("div",{className:"form-control",children:e.jsx(v,{label:"Gateway",readOnly:!0,type:"text",placeholder:"gateway",value:R.gateway})}),e.jsx("div",{className:"form-control",children:e.jsx(v,{label:"MAC Address",readOnly:!0,type:"text",placeholder:"mac",value:R.mac})}),e.jsx("div",{className:"form-control",children:e.jsx(v,{label:"Local time",readOnly:!0,type:"text",placeholder:"time",value:new Date(R.localtime)})})]})}),e.jsx(L,{options:"spacer",children:e.jsxs(S,{children:[e.jsx("div",{className:"headline",children:"System debug information: (Work in progress)"}),e.jsxs("div",{className:"form-control",children:[e.jsxs("label",{children:["Hue-Emulator ",i.branch," Version: ",i.diyhue]}),e.jsxs("label",{children:["WebUI Version: ",i.webui]}),e.jsxs("label",{children:["Architecture: ",i.machine]}),e.jsxs("label",{children:["OS: ",i.sysname]}),e.jsxs("label",{children:[i.sysname," version: ",i.os_version]}),e.jsxs("label",{children:[i.sysname," release: ",i.os_release]}),e.jsx("label",{children:"Hardware: %Hardware%"})]})]})}),e.jsx(L,{options:"spacer",children:e.jsxs(S,{children:[e.jsx("div",{className:"headline",children:"Bridge control"}),e.jsx("div",{className:"form-control",children:e.jsx(d,{value:`${U?"Hide":"Show"} advanced config`,color:"blue",size:"",type:"submit",onClick:()=>O(!U)})}),e.jsx("div",{className:"form-control",children:e.jsx(d,{value:"Force Config Dump",color:"blue",size:"",type:"submit",onClick:()=>ce()})}),e.jsx("div",{className:"form-control",children:e.jsx(d,{value:"Download debug",color:"blue",size:"",type:"submit",onClick:()=>be()})}),U===!0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"form-control",children:e.jsx(d,{value:"Restart Python",color:"red",size:"",type:"submit",onClick:()=>de()})}),e.jsx("div",{className:"form-control",children:e.jsx(d,{value:"Force Config Reset",color:"red",size:"",type:"submit",onClick:()=>ue()})})]}),e.jsx(we,{isOpen:Q,closeWizard:g,headline:Z,children:F})]})})]})})};export{Te as default};

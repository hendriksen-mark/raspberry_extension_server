import{r as b,j as e,G as N,a as g,n,M as w,T as M,b as k,B as z,W as I}from"./index.js";import{G as m}from"./GenericText.js";import{S as j}from"./SelectMenu.js";import{C as D}from"./CardGrid.js";import{G as A}from"./GlassContainer.js";import{H as $}from"./hass-hue-icons.js";import{I as C}from"./IconButton.js";import{c as L}from"./reactConfirmAlert.js";const B=({HOST_IP:s,API_KEY:r,closeWizard:i})=>{const[l,x]=b.useState({protocol:"auto"}),a=(o,t)=>{x({...l,[o]:t})},v=()=>{const{protocol:o,ip:t,...c}=l,d={protocol:o,ip:t,config:c};o==="dummy"&&(d.ip="dummy"),g.post(`${s}/api/${r}/lights`,d).then(()=>{n.success("Light added!")}).catch(y=>{console.error(y),n.error(`Error occurred: ${y.message}`)}),i(!0)},u=[{value:"auto",label:"Autodetect"},{value:"domoticz",label:"Domoticz"},{value:"flex",label:"Flex"},{value:"jeedom",label:"Jeedom"},{value:"milight",label:"MiLight"},{value:"mibox",label:"Mi Box"},{value:"wiz",label:"Wiz"},{value:"dummy",label:"Dummy"}],f=[{value:"1",label:"1"},{value:"2",label:"2"},{value:"3",label:"3"},{value:"4",label:"4"}],h=[{value:"rgbw",label:"RGBW"},{value:"cct",label:"CCT"},{value:"rgb_cct",label:"RGB-CCT"},{value:"rgb",label:"RGB"}],p=[{value:"LOM001",label:"On/Off Plug"},{value:"LWB010",label:"Dimmable Light"},{value:"LTW001",label:"Color temperature Light"},{value:"LCT015",label:"Color Light"},{value:"LST002",label:"Color Strip"}];return e.jsxs(e.Fragment,{children:[e.jsx(j,{label:"Protocol:",value:u[0],options:u,placeholder:l.protocol,onChange:o=>a("protocol",o.value)}),l.protocol!=="dummy"&&e.jsx("div",{className:"form-control",children:e.jsx(m,{label:"Light IP Address",type:"text",placeholder:"192.168.x.x",value:l.ip,onChange:o=>a("ip",o)})}),l.protocol!=="auto"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"form-control",children:e.jsx(m,{label:"Name",type:"text",placeholder:"Name used on diyhue",value:l.lightName,onChange:o=>a("lightName",o)})}),e.jsx("div",{className:"form-control",children:e.jsx(j,{label:"Emulated light type:",options:p,placeholder:l.lightModelID,onChange:o=>a("lightModelID",o.value)})})]}),(l.protocol==="milight"||l.protocol==="mibox")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"form-control",children:e.jsx(m,{label:"Device ID",type:"text",placeholder:"0x1234",value:l.miID,onChange:o=>a("miID",o)})}),e.jsx("div",{className:"form-control",children:e.jsx(j,{label:"Choose light mode:",options:h,placeholder:l.miModes,onChange:o=>a("miModes",o.value)})}),e.jsx("div",{className:"form-control",children:e.jsx(j,{label:"Choose light group:",options:f,placeholder:l.miGroups,onChange:o=>a("miGroups",o.value)})})]}),l.protocol==="mibox"&&e.jsx("div",{className:"form-control",children:e.jsx(m,{label:"Port",type:"number",placeholder:"Mi Box port",value:l.miBoxPort,onChange:o=>a("miboxPort",o)})}),l.protocol==="domoticz"&&e.jsx("div",{className:"form-control",children:e.jsx(m,{label:"Device ID",type:"text",placeholder:"Device ID",value:l.domoticzID,onChange:o=>a("domoticzID",o)})}),l.protocol==="jeedom"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"form-control",children:e.jsx(m,{label:"Light Api",type:"text",placeholder:"Light Api",value:l.jeedomlightAPI,onChange:o=>a("jeedomlightAPI",o)})}),e.jsx("div",{className:"form-control",children:e.jsx(m,{label:"Light ID",type:"text",placeholder:"Light ID",value:l.jeedomlightID,onChange:o=>a("jeedomlightID",o)})})]}),e.jsx("div",{className:"form-control",children:e.jsx(N,{value:"Add Light",color:"blue",size:"",type:"submit",onClick:()=>v()})})]})};function W(s){return e.jsxs("svg",{viewBox:"0 0 95 95",xmlns:"http://www.w3.org/2000/svg",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2",...s,children:[e.jsx("path",{d:"m33.083 39.685-.001 3.175h1.588v-1.588c0-.876-.711-1.587-1.587-1.587m5.288 3.175h12.7c0-.876-.711-1.588-1.587-1.588h-9.525a1.59 1.59 0 0 0-1.588 1.588m22.001-7.463c.39 1.238.61 2.549.633 3.907.002.08.002 3.475.002 3.556h-5.173c0-.876.711-1.588 1.587-1.588h1.999l-.002-1.941a12 12 0 0 0-.216-2.096 1.59 1.59 0 0 1 1.17-1.838M42.568 26.38a1.59 1.59 0 0 1-.798 2.029q-.559.263-1.086.578l-.15.09a12.4 12.4 0 0 0-4.653 5.153 1.587 1.587 0 0 1-2.036.777 13.98 13.98 0 0 1 8.723-8.627m4.682-.728a13.96 13.96 0 0 1 10.947 5.536 1.59 1.59 0 0 1-2.177-.113q-.486-.51-1.028-.961a12.34 12.34 0 0 0-6.36-2.777 1.587 1.587 0 0 1-1.382-1.685",fill:"#fff",fillOpacity:".47"}),e.jsx("path",{d:"M47.395.002C73.553.002 94.79 21.24 94.79 47.396S73.553 94.79 47.395 94.79.001 73.553.001 47.396 21.238.002 47.395.002m0 6c22.846 0 41.394 18.548 41.394 41.394S70.241 88.789 47.395 88.789 6.001 70.242 6.001 47.396 24.55 6.002 47.395 6.002",fill:"#fff"}),e.jsx("path",{d:"M40.717 65.549c0 .504.145.996.42 1.417l1.367 2.055c.418.63 1.369 1.144 2.125 1.144h4.915c.751 0 1.701-.513 2.12-1.144l1.363-2.055c.233-.356.426-.991.426-1.417l.009-3.139H40.709zM33.06 43.54H17.227a1.999 1.999 0 0 1 0-3.996h60.341a1.999 1.999 0 0 1 0 3.996H61.11c-.08 3.488-1.371 6.594-3.467 8.927-1.318 1.51-3.375 4.662-4.162 7.322l-.01.062h-12.77l-.01-.062c-.787-2.66-2.843-5.813-4.161-7.322a14.04 14.04 0 0 1-3.47-8.927m24.223 0a10.43 10.43 0 0 1-2.512 6.462c-1.25 1.43-2.795 3.707-3.91 6.075h-7.543c-1.116-2.368-2.66-4.646-3.908-6.075a10.4 10.4 0 0 1-2.52-6.462z",fill:"#fff"})]})}const S=({light:s,lightsCatalog:r})=>{const i=()=>{L({title:"Update light "+s.name+" firmware?",message:"Are you sure to do this?",buttons:[{label:"Yes",onClick:()=>l()},{label:"No"}]})},l=()=>{n.success("Begin light firmware update")};return e.jsx(e.Fragment,{children:["native_single","native_multi"].includes(s.protocol)&&r.lenght>2&&s.protocol_cfg.version===r[s.protocol_cfg.type].version&&e.jsx(C,{iconName:w,size:"small",color:"blue",title:"Update available",onClick:()=>i()})})},G=({HOST_IP:s,api_key:r,id:i,light:l,modelIds:x,lightsCatalog:a})=>{const v=()=>{L({title:"Delete light "+l.name,message:"Are you sure to do this?",buttons:[{label:"Yes",onClick:()=>u()},{label:"No"}]})},u=()=>{g.delete(`${s}/api/${r}/lights/${i}`).then(t=>{n.success("Light successfully deleted")}).catch(t=>{console.error(t),n.error("Error occured, check browser console")})},f=()=>{g.put(`${s}/api/${r}/lights/${i}/state`,{alert:"select"}).then(t=>{n.success("Light alerted")}).catch(t=>{console.error(t),n.error("Error occured, check browser console")})},h=t=>{t.startsWith("LCX")||t==="915005987201"?L({title:t+" only works with native gradient sketch",message:`See documentation for more information: 
        https://diyhue.readthedocs.io/en/latest/lights/lightTypes.html`,buttons:[{label:"Confirm",onClick:()=>p(t)},{label:"Dismiss"}]}):p(t)},p=t=>{g.post(`${s}/light-types`,{[i]:t}).then(c=>{n.success("Modelid updated")}).catch(c=>{console.error(c),n.error("Error occured, check browser console")})};let o=x.map(function(t){return{value:t,label:t}});return e.jsx(A,{children:e.jsxs("div",{className:"top",children:[e.jsxs("div",{className:"row1",children:[e.jsx(M,{title:"Alert",arrow:!0,children:e.jsx("div",{className:"hueicon",onClick:()=>f(),children:e.jsx($,{type:"light-"+l.config.archetype,color:"#eeeeee"})})}),e.jsxs("div",{className:"text",children:[l.name," "]})]}),e.jsx(j,{value:{value:l.modelid,label:l.modelid},label:"",options:o,onChange:t=>h(t.value),placeholder:l.modelid}),e.jsxs("div",{className:"row2",children:[e.jsxs("ul",{children:[e.jsxs("li",{children:["Protocol: ",l.protocol]}),["native","native_multi","native_single","wled","esphome"].includes(l.protocol)?e.jsxs("li",{style:{cursor:"pointer"},onClick:()=>window.open("http://"+l.protocol_cfg.ip,"_blank"),children:["IP: ",l.protocol_cfg.ip]}):e.jsxs("li",{children:["IP: ",l.protocol_cfg.ip]})]}),e.jsx(S,{light:l,lightsCatalog:a}),e.jsx(C,{iconName:k,title:"Delete",size:"small",color:"red",onClick:()=>v()})]}),l.state.reachable||e.jsx("div",{className:"label",children:"Offline"})]})})};function J({HOST_IP:s,API_KEY:r,CONFIG:i}){const l=i.lightTypes,[x,a]=b.useState(i.lights),[v,u]=b.useState({}),[f,h]=b.useState(!1),p=()=>{h(!0)},o=(c=!1)=>{c?h(!1):L({title:"Confirm to close",message:"You have unsaved changes. Are you sure you want to close?",buttons:[{label:"Yes",onClick:()=>h(!1)},{label:"No",onClick:()=>{}}]})},t=()=>{r!==void 0&&g.post(`${s}/api/${r}/lights`,"").then(c=>{n.success("Searching for new lights...")}).catch(c=>{console.error(c),n.error(`Error occurred: ${c.message}`)})};return b.useEffect(()=>{a(i.lights),(()=>{r!==void 0&&g.get("https://raw.githubusercontent.com/diyhue/Lights/master/catalog.json").then(d=>{u(d.data)}).catch(d=>{console.error(d),n.error(`Error occurred: ${d.message}`)})})()},[s,r,i]),e.jsxs("div",{className:"content",children:[e.jsxs("div",{className:"inner",children:[e.jsxs(D,{children:[e.jsx(C,{iconName:z,title:"Add light",size:"big",color:"btn",label:"Add light",onClick:()=>p()}),e.jsx(C,{iconName:W,title:"Scan for lights",size:"big",color:"btn",label:"Scan for lights",onClick:()=>t()})]}),e.jsx(D,{children:Object.entries(x).map(([c,d])=>e.jsx(G,{HOST_IP:s,api_key:r,id:c,light:d,modelIds:l,lightsCatalog:v},c))})]}),e.jsx(I,{isOpen:f,closeWizard:()=>o(!1),headline:"Add Light",children:e.jsx(B,{HOST_IP:s,API_KEY:r,closeWizard:o})})]})}export{J as default};
